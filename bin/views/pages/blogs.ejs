<h1>
    Lista de Postagens 
    <a class="ml-4 btn btn-primary" href="/secure/blog/add" title="Novo">Nova postagem</a>
</h1>

<div class="my-3 js-blogs-list">
    <i class="fas fa-circle-notch fa-spin fa-3x"></i>
</div>

<script type="text/javascript">

    document.addEventListener("DOMContentLoaded", function () {
        const $doc = $(document),
            blogsContainer = $doc.find('.js-blogs-list');

        $.ajax({
            type: 'GET',
            url: "/api/blogs",
        })
            .done(function (data) {
                let html = `<div><table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Titulo</th>
                            <th>Criado</th>
                            <th>Editado</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table></div>`;

                let tbody = '';

                data.forEach(element => {
                    let btn = getHtmlActions(element);
                    let options = {
                        day: 'numeric',
                        month: 'numeric',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit',
                    };
                    let created_at = new Date(element.created_at).toLocaleDateString('pt-br', options);
                    let updated_at = new Date(element.updated_at).toLocaleDateString('pt-br', options);

                    tbody += `
                    <tr>
                        <td>${element.title}</td>
                        <td>${!!element.created_at ? created_at : '-'}</td>
                        <td>${!!element.updated_at ? updated_at : '-'}</td>
                        <td>${btn}</td>
                    </tr>`;

                });

                html = $(html).find('tbody').html(tbody).parents('div').html();
                blogsContainer.html(html);

            })
            .fail(function (err) {
                console.error(err);
            })
            .always(function () {
                blogsContainer.find('table').DataTable({"order": [[ 1, "desc" ]]});
            });
    });

    function getHtmlActions(data) {
        const btn = `
        <a class="btn btn-link" href="/secure/blogs/${data._id}" title="Abrir"><i class="far fa-eye"></i></a>
        <a class="btn btn-link" href="/secure/blogs/${data._id}/edit" title="Editar"><i class="far fa-edit"></i></a>
        <a class="btn btn-link text-danger" href="/secure/blogs/${data._id}/delete" title="Deletar"><i class="far fa-trash-alt"></i></a>
        `;
        return btn;
    }

</script>